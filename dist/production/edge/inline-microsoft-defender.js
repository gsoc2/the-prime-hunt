(()=>{"use strict";var e,t={5673:(e,t,n)=>{var r,o;n.d(t,{$b:()=>o,H$:()=>i,Kt:()=>r}),function(e){e.production="production",e.development="development"}(r||(r={})),function(e){e.info="info",e.debug="debug",e.error="error",e.warn="warn"}(o||(o={}));const i=e=>e},9896:(e,t,n)=>{n.d(t,{Mq:()=>i,dm:()=>s});var r=n(2167),o=n(5673);Object.values(r.bA).includes(null),Object.values(r.bA).includes(null);const i="production"===o.Kt.production?o.Kt.production:o.Kt.development,s=Object.keys(o.$b).includes("info")?"info":o.$b.info},5656:(e,t,n)=>{n.d(t,{C$:()=>i,pM:()=>a});var r=n(5673),o=n(9896);let i,s=o.Mq===r.Kt.development||o.dm===r.$b.debug;const a=e=>{s=e};class c{prefix="";level=r.$b.info;createInstance(e="",t=r.$b.info){return new c(e,t)}constructor(e="",t=r.$b.info){this.prefix=e,this.level=t}log(...e){(this.level!==r.$b.debug||s)&&console[this.level===r.$b.error?"error":this.level===r.$b.warn?"warn":"log"](this.prefix||"==>",...e)}error(){return this.createInstance(`ERROR: ${this.prefix}`,r.$b.error)}warn(){return this.createInstance(`WARN: ${this.prefix}`,r.$b.warn)}info(){return this.createInstance(`INFO: ${this.prefix}`,r.$b.info)}debug(){return this.createInstance(`DEBUG: ${this.prefix}`,r.$b.debug)}addPrefix(e){return this.createInstance([this.prefix,e].join(" "),this.level)}setLevel(e){return this.createInstance(this.prefix,e)}setPrefix(e){return i=this.addPrefix(e),i}}i=new c},5745:(e,t,n)=>{n.d(t,{Nm:()=>i,a9:()=>r,oZ:()=>o});const r=e=>"background"===e?"bg ==>":"content"===e?"cs ==>":"inline"===e?"is ==>":"app"===e?"app ==>":"unknown ==>",o=e=>{let t=(e||"").slice(0,3).toLowerCase();return"app"===t?"app":(t=t.slice(0,2),"bg"===t?"background":"cs"===t?"content":"is"===t?"inline":"unknown")},i="debug-external-der3edc3op3e4dde44rt"},2167:(e,t,n)=>{var r,o,i,s,a;n.d(t,{TT:()=>a,bA:()=>o,by:()=>s}),function(e){e.chrome="chrome",e.firefox="firefox",e.edge="edge"}(r||(r={})),function(e){e.MicrosoftSentinel="MicrosoftSentinel",e.MicrosoftDefender="MicrosoftDefender",e.Splunk="Splunk",e.QRadar="QRadar",e.Elastic="Elastic",e.OpenSearch="OpenSearch",e.ArcSight="ArcSight",e.Athena="Athena",e.LogScale="LogScale",e.Chronicle="Chronicle"}(o||(o={})),function(e){e.ElasticEQl="ElasticEql"}(i||(i={})),function(e){e.Sentinel="ala",e.Defender="mdatp",e.Splunk="splunk",e.Qradar="qradar",e.ElasticEQL="es-eql",e.ElasticLucene="elasticsearch",e.ArcSight="arcsight-keyword",e.Athena="athena",e.LogScale="humio",e.Chronicle="chronicle-query",e.OpenSearch="opendistro-query"}(s||(s={})),function(e){e.MicrosoftSentinel="Microsoft Sentinel",e.MicrosoftDefender="Microsoft Defender For Endpoint",e.Splunk="Splunk",e.QRadar="IBM QRadar",e.Elastic="Elastic",e.OpenSearch="OpenSearch",e.ArcSight="ArcSight",e.Athena="Amazon Athena",e.LogScale="Falcon LogScale",e.Chronicle="Chronicle"}(a||(a={}))}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=r(5745),r(5656).C$.setPrefix((0,e.a9)("inline")),(()=>{var e,t=r(5745);!function(e){e.ISModifyQuery="ISModifyQuery",e.ISSetQuery="ISSetQuery",e.ISGetQuery="ISGetQuery",e.ISSetDebugMode="ISSetDebugMode",e.ISRemoveHash="ISRemoveHash",e.ISRemoveFieldSpecification="ISRemoveFieldSpecification"}(e||(e={})),Object.values(e).forEach((e=>{if("inline"!==(0,t.oZ)(e))throw new Error(`Wrong inline message type "${e}"`)}));var n=r(5656);const o=(e,t,...r)=>!!e()&&(n.C$.debug().log(`got ${t.type} message`,t,...r),!0);var i=r(5673);const s=e=>{if("number"==typeof e)return!0;if("string"!=typeof e)return!1;const t=e.trim();return!(!/^[-.0-9]*$/.test(t)||c(t,".").length>1)&&!Number.isNaN(parseFloat(t))},a=()=>Math.random().toString(36).substring(5)+Date.now().toString(36)+Math.random().toString(36).substring(5),c=(e,t)=>{const n=[];let r=-1;for(;(r=e.indexOf(t,r+1))>=0;)n.push(r);return n},d=e=>monaco.editor.getModels()[e],l=(e,t,n)=>{const r=((e,t)=>{try{return JSON.parse(e)}catch(e){return t}})(e.getValue(),null),o=r&&r.Query?r.Query:"",i=`${"show all"===n?o.split("|").shift()?.trim()||"<unknown>":o} ${t}`;return JSON.stringify({Query:i},null,3)};var u;!function(e){e.OnMessage="OnMessage"}(u||(u={}));var p,g=r(2167);!function(e){e[e.debugIDExternal=(0,i.H$)(t.Nm)]="debugIDExternal"}(p||(p={}));const f=()=>"undefined"!=typeof browser?browser:chrome,h=r(5656).C$.addPrefix("api-support"),b=(...e)=>!!f()?.runtime?.getURL||(h.warn().log("API runtime.getURL is not supported",...e),!1),S={},y=[];S[u.OnMessage]=(e,...n)=>{if(((...e)=>!!f().runtime?.onMessage?.addListener||(h.warn().log("API runtime.onMessage.addListener is not supported",...e),!1))()){const t=f().runtime.onMessage;y.push((()=>{t.removeListener(e)})),t.addListener(((...t)=>{e(...t)}),...n)}if(!((...e)=>!!window?.addEventListener||(h.warn().log("API window.addEventListener is not supported",...e),!1))())return;const r=r=>{const o=r.data;r.origin!==window.location.origin||"content"!==(0,t.oZ)(o.type)&&o.externalType!==p.debugIDExternal||e(r.data,...n)};y.push((()=>{window.removeEventListener("message",r)})),window.addEventListener("message",r)};const m=(e,t,n)=>{const r=document.createElement(e);return n?.attributes&&Object.keys(n.attributes).forEach((e=>{var t;r.setAttribute(e,"style"===e?(t=n.attributes[e],Object.keys(t).reduce(((e,n)=>e+`${n}:${t[n]};`),"")):n.attributes?.[e]||"")})),n?.innerHtml&&(r.innerHTML=n.innerHtml),n?.innerText&&(r.innerText=n.innerText),t&&t.append(r),r},A="inline-microsoft-defender.js";g.bA.MicrosoftSentinel,g.bA.MicrosoftDefender,g.bA.Splunk,g.bA.QRadar,g.bA.Elastic,g.bA.ArcSight,g.bA.Athena,g.bA.OpenSearch,g.bA.LogScale,g.bA.Chronicle;var M;!function(e){e.Accounts="Accounts",e.Assets="Assets"}(M||(M={}));Object.keys(M);var w;!function(e){e.CSConnectPlatform="CSConnectPlatform",e.CSSetDebugMode="CSSetDebugMode",e.CSDirectMessageToApp="CSDirectMessageToApp",e.CSDirectMessageToInline="CSDirectMessageToInline"}(w||(w={})),Object.values(w).forEach((e=>{if("content"!==(0,t.oZ)(e))throw new Error(`Wrong content message type "${e}"`)}));const $=r(5656).C$.addPrefix("services"),v=(e,t,n=!0)=>{t.id=`${t.id?`${t.id}--`:""}${a()}`;const r="sendMessage";try{return n||((...e)=>!!window?.postMessage||(h.warn().log("API window.postMessage is not supported",...e),!1))(t)?n?((...e)=>!!f()?.runtime?.sendMessage||(h.warn().log("API runtime.sendMessage is not supported",...e),!1))()?(f().runtime.sendMessage(t)?.catch((n=>e.error().addPrefix(r).log(n,t))),e.debug().addPrefix(r).log(t),t):t:(window.postMessage(t),e.debug().log("postMessage",t),t):t}catch(n){return e.error().addPrefix(r).log(n,t),t}},x=(e,t=!0)=>v($.addPrefix("message-from-content"),e,t);var D;!function(e){e.BGDirectMessageToApp="BGDirectMessageToApp",e.BGDirectMessageToInline="BGDirectMessageToInline",e.BGSetWatchers="BGSetWatchers",e.BGRegisterPlatformTab="BGRegisterPlatformTab",e.BGToggleShowExtension="BGToggleShowExtension",e.BGSetDebugMode="BGSetDebugMode",e.BGTakeCallbackMessage="BGTakeCallbackMessage"}(D||(D={})),Object.values(D).forEach((e=>{if("background"!==(0,t.oZ)(e))throw new Error(`Wrong background message type "${e}"`)}));class I{fields=new Set;static processInlineListeners(t){if(o((()=>w.CSSetDebugMode===t.type),t)){const{debugMode:n}=t.payload;r(5656).pM(n),x({...t,id:`${t.id}--${t.type}`,type:e.ISSetDebugMode},!1)}if(o((()=>w.CSDirectMessageToApp===t.type),t)&&x({id:`${t.id}--${t.type}`,type:D.BGDirectMessageToApp,payload:t.payload}),o((()=>w.CSDirectMessageToInline===t.type),t)){const{type:e,payload:n}=t.payload;x({id:`${t.id}--${t.type}`,type:e,payload:n},!1)}}}let T;class E extends I{defaultWatchers={[M.Accounts]:["AccountName","InitiatingProcessAccountName","RequestAccountName","InitiatingProcessAccountSid","RequestAccountName"],[M.Assets]:["DeviceName","AccountDomain","InitiatingProcessAccountDomain"]};static id=g.bA.MicrosoftDefender;static extensionDefaultPosition={top:0,left:0,width:480,height:480};static buildQueryParts(e,t,n=!1){return((e,t,n,r,o,i)=>{const s=[];Object.keys(e).forEach((r=>{s.push(e[r].map((e=>`${o.leftOperand(r)}${t(r,e)}${o.rightOperand(e)}`)).join(n))}));const a=s.join(r);return i?`${i} ${a}`:a})(t,(()=>"exclude"===e?" != ":" == "),"exclude"===e?" and ":" or ","exclude"===e?" and ":" or ",{leftOperand:e=>e,rightOperand:e=>E.normalizedValue(e)},n?"where":void 0)}static normalizedValue=e=>{const t=s(e)?parseFloat(e):e;return"number"==typeof t?t:`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`};buildQueryParts(e,t,n){return E.buildQueryParts(e,t,n)}extensionDefaultPosition=E.extensionDefaultPosition;getID(){return E.id}getName(){return g.TT.MicrosoftDefender}getType(){return g.by.Defender}static setListeners(){((e,t,...n)=>{S[e]?.(((...e)=>{t(...e)}),...n)})(u.OnMessage,(e=>{I.processInlineListeners(e)})),T.debug().log("listeners were set")}static connectInlineListener(){var e;m("script",document.body,{attributes:{src:(e=A,b(e)?f().runtime.getURL(e):""),type:"text/javascript","data-type":"inline-listener"}})}connect(){E.setListeners(),E.connectInlineListener(),T.debug().log("connected")}}var k;T=r(5656).C$.addPrefix(E.id),function(e){e.AppShowExtension="AppShowExtension",e.AppTakeResourceData="AppTakeResourceData",e.AppTakeNewResourceData="AppTakeNewResourceData",e.AppSyncWatchers="AppSyncWatchers",e.AppQueryHasHash="AppQueryHasHash",e.AppQueryHasSpecifyFields="AppQueryHasSpecifyFields",e.AppSetLoadingState="AppSetLoadingState",e.AppToggleShowExtension="AppToggleShowExtension",e.AppSendToBackground="AppSendToBackground",e.AppSendMessageOutside="AppSendMessageOutside",e.AppTakeQuery="AppTakeQuery",e.AppSetDebugMode="AppSetDebugMode",e.AppTakeCallbackMessageResult="AppTakeCallbackMessageResult"}(k||(k={})),Object.values(k).forEach((e=>{if("app"!==(0,t.oZ)(e))throw new Error(`Wrong app message type "${e}"`)}));const C=new E,L=r(5656).C$.addPrefix(C.getID());let O=2;const P=()=>{const e=Array.from(document.querySelectorAll('.response-editor .monaco-editor[data-uri^="inmemory:"]')).filter((e=>e.scrollWidth>5)),t=Array.from(document.querySelectorAll('.monaco-editor[data-uri^="inmemory:"]')).filter((e=>e.scrollWidth>5)).filter((t=>!e.includes(t)))[0];if(!t)return null;const n=(e=>monaco.editor.getModels().findIndex((t=>t.uri._formatted===e)))(t.getAttribute("data-uri")||"#failed");return"number"==typeof n&&n>-1?n:null},Q=()=>{const e=P();if("number"!=typeof e||e<0)return L.info().log("Can not determine the editor index"),{};const t=d(e);return t?{editor:t,index:e}:(L.error().log("editor not found by index",e,monaco),{})};window.addEventListener("message",(t=>{const n=t.data;if(o((()=>e.ISModifyQuery===n.type),n,t)){if(!monaco?.editor?.getModels?.())return void L.error().log("editor not found",monaco);if(null===(i=P())||(O!==i&&(O=i,L.debug().log("The editor index is set to",i)),0))return void L.info().log("Can not determine the editor index");const{resources:e,modifyType:t}=n.payload,{href:r}=window.location,o=`| ${C.buildQueryParts(t,e,!0)}`,s=d(O),a=r.indexOf("security.microsoft.com/v2/advanced-hunting")>-1?((e,t,n,r=!0)=>{let o="";const i=e.getLinesContent(),s=(e=>{const t=[];for(let n=1;n<=e.getLineCount();n++)e.getLineDecorations(n).some((e=>e.options.className))&&""!==e.getLineContent(n)?.trim()&&t.push(n);return t})(e);if("show all"===n&&s.length<1){const e=i.map((e=>e.split("|").shift())).filter(Boolean).pop()||"<unknown>";o=`${r?`${e} `:""}${t}`}if("show all"===n&&s.length>=1){const e=i[s[0]-1].split("|").shift();i.splice(s[0]-1,s.length,`${r?`${e} `:""}${t}`),o=i.join("\n")}if("show all"!==n){const n=s.length>0?s[s.length-1]:(e=>{const t=e.getLinesContent();for(;""===t[t.length-1]?.trim();)t.splice(t.length-1);return t.length>0?t.length:1})(e),r=e.getLineContent(n)||"<unknown>";i[n-1]=`${r} ${t}`,o=i.join("\n")}return o.replace(/ +/g," ")})(s,o,t):l(s,o,t);s.setValue(a)}var i,s,c;if(o((()=>e.ISSetQuery===n.type),n,t)){const{editor:e}=Q();if(e){const{value:t}=n.payload;e.setValue(t)}}if(o((()=>e.ISGetQuery===n.type),n,t)){const{editor:e}=Q();if(!e)return;((s=e.getValue())||c)&&window.postMessage({id:a(),type:w.CSDirectMessageToApp,payload:{type:k.AppTakeQuery,payload:{queryValue:s,queryMeta:c}}})}if(o((()=>e.ISSetDebugMode===n.type),n,t)){const{debugMode:e}=n.payload;r(5656).pM(e)}})),L.debug().log("mounted")})()})();