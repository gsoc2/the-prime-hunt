(()=>{"use strict";var e={7838:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAllowedProtocol=t.isNumberInString=t.isNotEmpty=t.isString=void 0;const r=o(9068);t.isString=e=>"string"==typeof e;t.isNotEmpty=e=>!!(0,t.isString)(e)&&""!==e.trim();t.isNumberInString=e=>{if("string"!=typeof e)return!1;const t=e.trim();return!!/^[.0-9]*$/.test(t)&&!Number.isNaN(parseFloat(t))};t.isAllowedProtocol=(e,t)=>{if(t===r.Mode.development)return!0;const o=e.trim().toLowerCase();return"https:"===o||"https"===o}},412:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.capitalizeFirstLetter=t.formatString=t.deduplicateArray=t.parseJSONSafe=t.clearExtraSpaces=t.uuid=t.isFlatObjectsEqual=void 0;t.isFlatObjectsEqual=(e,t)=>{const o=Object.keys(e),r=Object.keys(t);return o.length===r.length&&!o.some((o=>e[o]!==t[o]))};t.uuid=()=>Math.random().toString(36).substring(5)+Date.now().toString(36)+Math.random().toString(36).substring(5);t.clearExtraSpaces=e=>e.replace(/ +/g," ");t.parseJSONSafe=(e,t)=>{try{return JSON.parse(e)}catch(e){return t}};t.deduplicateArray=e=>[...Array.from(new Set([...e]))];t.formatString=(e,t,o)=>Object.keys(t||{}).map((e=>({value:t[e],key:o?o(e):`%${e}`}))).reduce(((e,t)=>e.replace(new RegExp(t.key,"g"),t.value)),e)||e;t.capitalizeFirstLetter=e=>`${e.charAt(0).toUpperCase()}${e.slice(1)}`},9068:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapType=t.LogLevel=t.Mode=void 0,function(e){e.production="production",e.development="development"}(t.Mode||(t.Mode={})),function(e){e.info="info",e.debug="debug",e.error="error",e.warn="warn"}(t.LogLevel||(t.LogLevel={}));t.mapType=e=>e},5099:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRuntimeGetUrlSupported=t.isTabsSendMessageSupported=t.isTabsQuerySupported=t.isOnBeforeSendHeadersSupported=t.isOnBeforeRequestSupported=t.isBrowserActionOnClickedSupported=t.isActionOnClickedSupported=t.isTabsOnRemovedSupported=t.isRuntimeOnMessageExternalSupported=t.isRuntimeOnMessageSupported=t.isRuntimeSendMessageSupported=t.isAddEventListenerSupported=t.isPostMessageSupported=void 0;const r=o(332),n=o(5482).loggers.addPrefix("api-support");t.isPostMessageSupported=(...e)=>!!(null===window||void 0===window?void 0:window.postMessage)||(n.warn().log("API window.postMessage is not supported",...e),!1);t.isAddEventListenerSupported=(...e)=>!!(null===window||void 0===window?void 0:window.addEventListener)||(n.warn().log("API window.addEventListener is not supported",...e),!1);t.isRuntimeSendMessageSupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.runtime)||void 0===o?void 0:o.sendMessage)||(n.warn().log("API runtime.sendMessage is not supported",...e),!1)};t.isRuntimeOnMessageSupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)().runtime)||void 0===t?void 0:t.onMessage)||void 0===o?void 0:o.addListener)||(n.warn().log("API runtime.onMessage.addListener is not supported",...e),!1)};t.isRuntimeOnMessageExternalSupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)().runtime)||void 0===t?void 0:t.onMessageExternal)||void 0===o?void 0:o.addListener)||(n.warn().log("API runtime.onMessageExternal.addListener is not supported",...e),!1)};t.isTabsOnRemovedSupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)().tabs)||void 0===t?void 0:t.onRemoved)||void 0===o?void 0:o.addListener)||(n.warn().log("API tabs.onRemoved.addListener is not supported",...e),!1)};t.isActionOnClickedSupported=(...e)=>{var t,o,i;return!!(null===(i=null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.action)||void 0===o?void 0:o.onClicked)||void 0===i?void 0:i.addListener)||(n.warn().log("API action.onClicked.addListener is not supported",...e),!1)};t.isBrowserActionOnClickedSupported=(...e)=>{var t,o,i;return!!(null===(i=null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.browserAction)||void 0===o?void 0:o.onClicked)||void 0===i?void 0:i.addListener)||(n.warn().log("API browserAction.onClicked.addListener is not supported",...e),!1)};t.isOnBeforeRequestSupported=(...e)=>{var t,o,i;return!!(null===(i=null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.webRequest)||void 0===o?void 0:o.onBeforeRequest)||void 0===i?void 0:i.addListener)||(n.warn().log("API webRequest.onBeforeRequest is not supported",...e),!1)};t.isOnBeforeSendHeadersSupported=(...e)=>{var t,o,i;return!!(null===(i=null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.webRequest)||void 0===o?void 0:o.onBeforeSendHeaders)||void 0===i?void 0:i.addListener)||(n.warn().log("API webRequest.onBeforeSendHeaders is not supported",...e),!1)};t.isTabsQuerySupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.tabs)||void 0===o?void 0:o.query)||(n.warn().log("API tabs.query is not supported",...e),!1)};t.isTabsSendMessageSupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.tabs)||void 0===o?void 0:o.sendMessage)||(n.warn().log("API tabs.sendMessage is not supported",...e),!1)};t.isRuntimeGetUrlSupported=(...e)=>{var t,o;return!!(null===(o=null===(t=(0,r.getBrowserContext)())||void 0===t?void 0:t.runtime)||void 0===o?void 0:o.getURL)||(n.warn().log("API runtime.getURL is not supported",...e),!1)}},332:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function d(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,d)}l((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.compareVersions=t.getVersionFromString=t.removeDoubleQuotesAround=t.buildQueryParts=t.getElementsUnderCursor=t.downloadFile=t.copyToClipboard=t.createClassName=t.waitHTMLElement=t.isInsideIframe=t.mountHTMLElement=t.cssObjectToString=t.getExecutingContextByMessageType=t.getPlatformNameByID=t.getWebAccessibleUrl=t.getBrowserContext=void 0;const n=o(3319),i=o(5099);t.getBrowserContext=()=>"undefined"!=typeof browser?browser:chrome;t.getWebAccessibleUrl=e=>(0,i.isRuntimeGetUrlSupported)(e)?(0,t.getBrowserContext)().runtime.getURL(e):"";t.getPlatformNameByID=e=>e===n.PlatformID.MicrosoftSentinel?"Microsoft Sentinel":e===n.PlatformID.MicrosoftDefender?"Microsoft Defender For Endpoint":e===n.PlatformID.Splunk?"Splunk":"Unknown Platform";t.getExecutingContextByMessageType=e=>{let t=e.slice(0,3).toLowerCase();return"app"===t?"app":(t=t.slice(0,2),"bg"===t?"background":"cs"===t?"content":"is"===t?"inline":"unknown")};t.cssObjectToString=e=>Object.keys(e).reduce(((t,o)=>t+`${o}:${e[o]};`),"");t.mountHTMLElement=(e,o,r)=>{const n=document.createElement(e);return(null==r?void 0:r.attributes)&&Object.keys(r.attributes).forEach((e=>{var o;n.setAttribute(e,"style"===e?(0,t.cssObjectToString)(r.attributes[e]):(null===(o=r.attributes)||void 0===o?void 0:o[e])||"")})),(null==r?void 0:r.innerHtml)&&(n.innerHTML=r.innerHtml),(null==r?void 0:r.innerText)&&(n.innerText=r.innerText),o&&o.append(n),n};t.isInsideIframe=()=>{try{return window.self!==window.top}catch(e){return!0}};t.waitHTMLElement=(e,t=document)=>r(void 0,void 0,void 0,(function*(){return new Promise((o=>{new MutationObserver(((r,n)=>{const i=t.querySelector(e);i&&(n.disconnect(),o(i))})).observe(t,{childList:!0,subtree:!0})}))}));t.createClassName=e=>e.filter(Boolean).join(" ");t.copyToClipboard=e=>{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-99999px",t.style.top="-99999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)};t.downloadFile=(e,t)=>{const o=document.createElement("a");o.setAttribute("href",encodeURI(`data:text/csv;charset=utf-8,${t}`)),o.setAttribute("download","extension-resources.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)};t.getElementsUnderCursor=(e,t)=>{const o=e.clientX,r=e.clientY,n=[],i=[];let s=document.elementFromPoint(o,r);for(;"HTML"!==s.tagName;){const e=s.style.pointerEvents;if(!s)break;(!t||t&&t(s))&&n.push(s),i.push({savedPointerEvents:e,element:s}),s.style.pointerEvents="none",s=document.elementFromPoint(o,r)}return i.forEach((({element:e,savedPointerEvents:t})=>{t?e.style.pointerEvents=t:e.style.removeProperty("pointer-events"),e.getAttribute("style")||e.removeAttribute("style")})),n};t.buildQueryParts=(e,t,o,r)=>Object.keys(e).reduce(((n,i)=>(n.push(e[i].map((e=>`${r.leftOperand(i)} ${t} ${r.rightOperand(e)}`)).join(o)),n)),[]).join(o);t.removeDoubleQuotesAround=e=>{let t=e;return'"'===e[0]&&(t=t.slice(1)),'"'===e[e.length-1]&&(t=t.slice(0,e.length-2)),t};t.getVersionFromString=e=>{if("string"!=typeof e||!/^[.0-9]+$/.test(e))return 0;const t=parseInt(e.replace(/\./g,""));return isNaN(t)?0:t};t.compareVersions=(e,o)=>{const r=(0,t.getVersionFromString)(e),n=(0,t.getVersionFromString)(o);return r===n?"equal":r>n?"greater":"less"}},3799:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMessageMatched=void 0;const r=o(5482),n=o(1846),i=o(332);t.isMessageMatched=(e,t,...o)=>!!e()&&(r.loggers.debug().addPrefix((0,n.getDebugPrefix)((0,i.getExecutingContextByMessageType)(t.type))).log(`got ${t.type} message`,t,...o),!0)},1595:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.logLevel=t.mode=t.backgroundPlatformIDFromENV=t.contentPlatformIDFromENV=void 0;const r=o(3319),n=o(9068);t.contentPlatformIDFromENV=(Object.values(r.PlatformID).includes(null),null),t.backgroundPlatformIDFromENV=(Object.values(r.PlatformID).includes(null),null),t.mode="production"===n.Mode.production?n.Mode.production:n.Mode.development,t.logLevel=Object.keys(n.LogLevel).includes("info")?"info":n.LogLevel.info,t.version="1.0.2"},5482:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loggers=t.Loggers=t.stopLogging=t.startLogging=void 0;const r=o(9068),n=o(1595);let i=!0;t.startLogging=()=>i=!0;t.stopLogging=()=>i=!1;class s{constructor(e="",t=r.LogLevel.info){this.prefix="",this.level=r.LogLevel.info,this.prefix=e,this.level=t}createInstance(e="",t=r.LogLevel.info){return new s(e,t)}log(...e){i&&(n.mode===r.Mode.production&&this.level===r.LogLevel.debug&&n.logLevel!==r.LogLevel.debug||n.mode!==r.Mode.production&&console[this.level===r.LogLevel.error?"error":this.level===r.LogLevel.warn?"warn":"log"](this.prefix||"==>",...e))}error(){return this.createInstance(`ERROR: ${this.prefix}`,r.LogLevel.error)}warn(){return this.createInstance(`WARN: ${this.prefix}`,r.LogLevel.warn)}info(){return this.createInstance(`INFO: ${this.prefix}`,r.LogLevel.info)}debug(){return this.createInstance(`DEBUG: ${this.prefix}`,r.LogLevel.debug)}addPrefix(e){return this.createInstance([this.prefix,e].join(" "),this.level)}setLevel(e){return this.createInstance(this.prefix,e)}}t.Loggers=s,t.loggers=new s},1846:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebugID=t.getDebugPrefix=void 0;const r=o(9068);t.getDebugPrefix=e=>"background"===e?"bg ==>":"content"===e?"cs ==>":"inline"===e?"is ==>":"app"===e?"app ==>":"unknown ==>";const n=(0,r.mapType)("debug-external-der3edc3op3e4dde44rt");!function(e){e[e.debugIDExternal=n]="debugIDExternal"}(t.DebugID||(t.DebugID={}))},3319:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformID=t.Browser=void 0,function(e){e.chrome="chrome",e.firefox="firefox",e.edge="edge"}(t.Browser||(t.Browser={})),function(e){e.MicrosoftSentinel="MicrosoftSentinel",e.MicrosoftDefender="MicrosoftDefender",e.Splunk="Splunk"}(t.PlatformID||(t.PlatformID={}))},6926:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildMicrosoftDefenderQueryParts=t.normalizedValue=void 0;const r=o(332),n=o(7838);t.normalizedValue=e=>{const t=(0,n.isNumberInString)(e)?parseFloat(e):e;return"number"==typeof t?t:`"${t.replace(/\\/g,"\\\\")}"`};t.buildMicrosoftDefenderQueryParts=(e,o)=>(0,r.buildQueryParts)(o,"exclude"===e?"!=":"==","exclude"===e?" and ":" or ",{leftOperand:e=>e,rightOperand:e=>(0,t.normalizedValue)(e)})},6474:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildNewQuery=t.buildNewJsonQuery=t.getEditorIndexByFormattedUri=t.getLastContentLine=t.getContentFocusedLines=t.checkEditorExists=t.getEditorByIndex=void 0;const r=o(412);t.getEditorByIndex=e=>monaco.editor.getModels()[e];t.checkEditorExists=()=>{var e,t;return!!(null===(t=null===(e=null===monaco||void 0===monaco?void 0:monaco.editor)||void 0===e?void 0:e.getModels)||void 0===t?void 0:t.call(e))};t.getContentFocusedLines=e=>{var o;const r=(0,t.getEditorByIndex)(e),n=[];for(let e=1;e<=r.getLineCount();e++)r.getLineDecorations(e).some((e=>e.options.className))&&""!==(null===(o=r.getLineContent(e))||void 0===o?void 0:o.trim())&&n.push(e);return n};t.getLastContentLine=e=>{var o;const r=(0,t.getEditorByIndex)(e).getLinesContent();for(;""===(null===(o=r[r.length-1])||void 0===o?void 0:o.trim());)r.splice(r.length-1);return r.length>0?r.length:1};t.getEditorIndexByFormattedUri=e=>monaco.editor.getModels().findIndex((t=>t.uri._formatted===e));t.buildNewJsonQuery=(e,o,n)=>{var i;const s=(0,t.getEditorByIndex)(e),d=(0,r.parseJSONSafe)(s.getValue(),null),l=d&&d.Query?d.Query:"",u=`${"show all"===n?(null===(i=l.split("|").shift())||void 0===i?void 0:i.trim())||"<unknown>":l} ${o}`;return JSON.stringify({Query:u},null,3)};t.buildNewQuery=(e,o,n)=>{let i="";const s=(0,t.getEditorByIndex)(e),d=s.getLinesContent(),l=(0,t.getContentFocusedLines)(e);if("show all"===n&&l.length<1){i=`${d.map((e=>e.split("|").shift())).filter(Boolean).pop()||"<unknown>"} ${o}`}if("show all"===n&&l.length>=1){const e=d[l[0]-1].split("|").shift();d.splice(l[0]-1,l.length,`${e} ${o}`),i=d.join("\n")}if("show all"!==n){const r=l.length>0?l[l.length-1]:(0,t.getLastContentLine)(e),n=s.getLineContent(r)||"<unknown>";d[r-1]=`${n} ${o}`,i=d.join("\n")}return(0,r.clearExtraSpaces)(i)}},4689:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageToInline=void 0;const r=o(332);var n;!function(e){e.ISModifyQuery="ISModifyQuery"}(n=t.MessageToInline||(t.MessageToInline={})),Object.values(n).forEach((e=>{if("inline"!==(0,r.getExecutingContextByMessageType)(e))throw new Error(`Wrong inline message type "${e}"`)}))}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,o),i.exports}(()=>{const e=o(4689),t=o(1846),r=o(3319),n=o(3799),i=o(6926),s=o(6474),d=o(5482).loggers.addPrefix((0,t.getDebugPrefix)("inline")).addPrefix(r.PlatformID.MicrosoftDefender);let l=2;window.addEventListener("message",(t=>{const o=t.data;if((0,n.isMessageMatched)((()=>e.MessageToInline.ISModifyQuery===o.type),o,t)){if(!(0,s.checkEditorExists)())return d.error().log("editor not found",monaco);if(null===(r=(()=>{let e=Array.from(document.querySelectorAll('.response-editor .monaco-editor[data-uri^="inmemory:"]')).filter((e=>e.scrollWidth>5));const t=Array.from(document.querySelectorAll('.monaco-editor[data-uri^="inmemory:"]')).filter((e=>e.scrollWidth>5)).filter((t=>!e.includes(t)))[0];if(!t)return null;const o=t.getAttribute("data-uri")||"#failed",r=(0,s.getEditorIndexByFormattedUri)(o);return"number"==typeof r&&r>-1?r:null})())||(l!==r&&(l=r,d.debug().log("The editor index is set to",r)),0))return d.info().log("Can not determine the editor index");const{resources:e,modifyType:t}=o.payload,{href:n}=document.location,u=` | where ${(0,i.buildMicrosoftDefenderQueryParts)(t,e)}`,a=(0,s.getEditorByIndex)(l),c=n.indexOf("security.microsoft.com/v2/advanced-hunting")>-1?(0,s.buildNewQuery)(l,u,t):(0,s.buildNewJsonQuery)(l,u,t);a.setValue(c)}var r})),d.debug().log("mounted")})()})();