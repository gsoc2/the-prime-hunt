(()=>{"use strict";var e,t={8667:(e,t,r)=>{var n,s;r.d(t,{AR:()=>n,in:()=>s,mr:()=>o}),function(e){e.production="production",e.development="development"}(n||(n={})),function(e){e.info="info",e.debug="debug",e.error="error",e.warn="warn"}(s||(s={}));const o=e=>e},6478:(e,t,r)=>{r.d(t,{hw:()=>i,xJ:()=>o});var n=r(7131),s=r(8667);Object.values(n.WM).includes(null),Object.values(n.WM).includes(null);const o="production"===s.AR.production?s.AR.production:s.AR.development,i=Object.keys(s.in).includes("info")?"info":s.in.info},2224:(e,t,r)=>{r.d(t,{Et:()=>o,yD:()=>a});var n=r(8667),s=r(6478);let o,i=s.xJ===n.AR.development||s.hw===n.in.debug;const a=e=>{i=e};class c{prefix="";level=n.in.info;createInstance(e="",t=n.in.info){return new c(e,t)}constructor(e="",t=n.in.info){this.prefix=e,this.level=t}log(...e){(this.level!==n.in.debug||i)&&console[this.level===n.in.error?"error":this.level===n.in.warn?"warn":"log"](this.prefix||"==>",...e)}error(){return this.createInstance(`ERROR: ${this.prefix}`,n.in.error)}warn(){return this.createInstance(`WARN: ${this.prefix}`,n.in.warn)}info(){return this.createInstance(`INFO: ${this.prefix}`,n.in.info)}debug(){return this.createInstance(`DEBUG: ${this.prefix}`,n.in.debug)}addPrefix(e){return this.createInstance([this.prefix,e].join(" "),this.level)}setLevel(e){return this.createInstance(this.prefix,e)}setPrefix(e){return o=this.addPrefix(e),o}}o=new c},6421:(e,t,r)=>{r.d(t,{k$:()=>s,kW:()=>n,qK:()=>o});const n=e=>"background"===e?"bg ==>":"content"===e?"cs ==>":"inline"===e?"is ==>":"app"===e?"app ==>":"unknown ==>",s=e=>{let t=(e||"").slice(0,3).toLowerCase();return"app"===t?"app":(t=t.slice(0,2),"bg"===t?"background":"cs"===t?"content":"is"===t?"inline":"unknown")},o="debug-external-der3edc3op3e4dde44rt"},7131:(e,t,r)=>{var n,s,o,i,a;r.d(t,{S9:()=>i,WM:()=>s,if:()=>a}),function(e){e.chrome="chrome",e.firefox="firefox",e.edge="edge"}(n||(n={})),function(e){e.MicrosoftSentinel="MicrosoftSentinel",e.MicrosoftDefender="MicrosoftDefender",e.Splunk="Splunk",e.QRadar="QRadar",e.Elastic="Elastic",e.OpenSearch="OpenSearch",e.ArcSight="ArcSight",e.Athena="Athena",e.LogScale="LogScale",e.Chronicle="Chronicle"}(s||(s={})),function(e){e.ElasticEQl="ElasticEql"}(o||(o={})),function(e){e.Sentinel="ala",e.Defender="mdatp",e.Splunk="splunk",e.Qradar="qradar",e.ElasticEQL="es-eql",e.ElasticLucene="elasticsearch",e.ArcSight="arcsight-keyword",e.Athena="athena",e.LogScale="humio",e.Chronicle="chronicle-query",e.OpenSearch="opendistro-query"}(i||(i={})),function(e){e.MicrosoftSentinel="Microsoft Sentinel",e.MicrosoftDefender="Microsoft Defender For Endpoint",e.Splunk="Splunk",e.QRadar="IBM QRadar",e.Elastic="Elastic",e.OpenSearch="OpenSearch",e.ArcSight="ArcSight",e.Athena="Amazon Athena",e.LogScale="Falcon LogScale",e.Chronicle="Chronicle"}(a||(a={}))}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=n(6421),n(2224).Et.setPrefix((0,e.kW)("inline")),(()=>{var e=n(2224);const t=(t,r,...n)=>!!t()&&(e.Et.debug().log(`got ${r.type} message`,r,...n),!0);var r,s=n(6421);!function(e){e.ISModifyQuery="ISModifyQuery",e.ISSetQuery="ISSetQuery",e.ISGetQuery="ISGetQuery",e.ISSetDebugMode="ISSetDebugMode",e.ISRemoveHash="ISRemoveHash",e.ISRemoveFieldSpecification="ISRemoveFieldSpecification"}(r||(r={})),Object.values(r).forEach((e=>{if("inline"!==(0,s.k$)(e))throw new Error(`Wrong inline message type "${e}"`)}));var o=n(8667);const i=e=>{if("number"==typeof e)return!0;if("string"!=typeof e)return!1;const t=e.trim();return!(!/^[-.0-9]*$/.test(t)||l(t,".").length>1)&&!Number.isNaN(parseFloat(t))},a=()=>Math.random().toString(36).substring(5)+Date.now().toString(36)+Math.random().toString(36).substring(5),c=(e,t)=>e>t?1:e<t?-1:0,l=(e,t)=>{const r=[];let n=-1;for(;(n=e.indexOf(t,n+1))>=0;)r.push(n);return r};var p;!function(e){e.CSConnectPlatform="CSConnectPlatform",e.CSSetDebugMode="CSSetDebugMode",e.CSDirectMessageToApp="CSDirectMessageToApp",e.CSDirectMessageToInline="CSDirectMessageToInline"}(p||(p={})),Object.values(p).forEach((e=>{if("content"!==(0,s.k$)(e))throw new Error(`Wrong content message type "${e}"`)}));const d=()=>"undefined"!=typeof browser?browser:chrome,u=n(2224).Et.addPrefix("api-support"),g=(...e)=>!!d()?.runtime?.getURL||(u.warn().log("API runtime.getURL is not supported",...e),!1),f=n(2224).Et.addPrefix("services"),h=(e,t,r=!0)=>{t.id=`${t.id?`${t.id}--`:""}${a()}`;const n="sendMessage";try{return r||((...e)=>!!window?.postMessage||(u.warn().log("API window.postMessage is not supported",...e),!1))(t)?r?((...e)=>!!d()?.runtime?.sendMessage||(u.warn().log("API runtime.sendMessage is not supported",...e),!1))()?(d().runtime.sendMessage(t)?.catch((r=>e.error().addPrefix(n).log(r,t))),e.debug().addPrefix(n).log(t),t):t:(window.postMessage(t),e.debug().log("postMessage",t),t):t}catch(r){return e.error().addPrefix(n).log(r,t),t}},S=(e,t=!0)=>h(f.addPrefix("message-from-content"),e,t);var y,m;!function(e){e.BGDirectMessageToApp="BGDirectMessageToApp",e.BGDirectMessageToInline="BGDirectMessageToInline",e.BGSetWatchers="BGSetWatchers",e.BGRegisterPlatformTab="BGRegisterPlatformTab",e.BGToggleShowExtension="BGToggleShowExtension",e.BGSetDebugMode="BGSetDebugMode",e.BGTakeCallbackMessage="BGTakeCallbackMessage"}(y||(y={})),Object.values(y).forEach((e=>{if("background"!==(0,s.k$)(e))throw new Error(`Wrong background message type "${e}"`)}));class M{fields=new Set;static processInlineListeners(e){if(t((()=>p.CSSetDebugMode===e.type),e)){const{debugMode:t}=e.payload;n(2224).yD(t),S({...e,id:`${e.id}--${e.type}`,type:r.ISSetDebugMode},!1)}if(t((()=>p.CSDirectMessageToApp===e.type),e)&&S({id:`${e.id}--${e.type}`,type:y.BGDirectMessageToApp,payload:e.payload}),t((()=>p.CSDirectMessageToInline===e.type),e)){const{type:t,payload:r}=e.payload;S({id:`${e.id}--${e.type}`,type:t,payload:r},!1)}}}!function(e){e.Accounts="Accounts",e.Assets="Assets"}(m||(m={}));Object.keys(m);var A;!function(e){e.OnMessage="OnMessage"}(A||(A={}));var b=n(7131);const w=(e,t,r)=>{const n=document.createElement(e);return r?.attributes&&Object.keys(r.attributes).forEach((e=>{var t;n.setAttribute(e,"style"===e?(t=r.attributes[e],Object.keys(t).reduce(((e,r)=>e+`${r}:${t[r]};`),"")):r.attributes?.[e]||"")})),r?.innerHtml&&(n.innerHTML=r.innerHtml),r?.innerText&&(n.innerText=r.innerText),t&&t.append(n),n};var v;!function(e){e[e.debugIDExternal=(0,o.mr)(s.qK)]="debugIDExternal"}(v||(v={}));const E={},x=[];E[A.OnMessage]=(e,...t)=>{if(((...e)=>!!d().runtime?.onMessage?.addListener||(u.warn().log("API runtime.onMessage.addListener is not supported",...e),!1))()){const r=d().runtime.onMessage;x.push((()=>{r.removeListener(e)})),r.addListener(((...t)=>{e(...t)}),...t)}if(!((...e)=>!!window?.addEventListener||(u.warn().log("API window.addEventListener is not supported",...e),!1))())return;const r=r=>{const n=r.data;r.origin!==window.location.origin||"content"!==(0,s.k$)(n.type)&&n.externalType!==v.debugIDExternal||e(r.data,...t)};x.push((()=>{window.removeEventListener("message",r)})),window.addEventListener("message",r)};const I="inline-amazon-athena.js";b.WM.MicrosoftSentinel,b.WM.MicrosoftDefender,b.WM.Splunk,b.WM.QRadar,b.WM.Elastic,b.WM.ArcSight,b.WM.Athena,b.WM.OpenSearch,b.WM.LogScale,b.WM.Chronicle;let $;class D extends M{static extensionDefaultPosition={top:0,left:0,width:480,height:480};defaultWatchers={[m.Accounts]:["actor.user.name"],[m.Assets]:["device.name"]};extensionDefaultPosition=D.extensionDefaultPosition;static normalizedValue(e){const t=i(e)?parseFloat(e):e;return"number"==typeof t?t:`'${t.replace(/'/g,'"')}'`}static id=b.WM.Athena;static buildQueryParts(e,t,r){return((e,t,r,n,s,o)=>{const i=[];Object.keys(e).forEach((n=>{i.push(e[n].map((e=>`${s.leftOperand(n)}${t(n,e)}${s.rightOperand(e)}`)).join(r))}));const a=i.join(n);return o?`${o} ${a}`:a})(t,(()=>"exclude"===e?" != ":" = "),"exclude"===e?" AND ":" OR ","exclude"===e?" AND ":" OR ",{leftOperand:e=>e,rightOperand:e=>D.normalizedValue(e)},r?"where":void 0)}buildQueryParts(e,t,r){return D.buildQueryParts(e,t,r)}static connectInlineListener(){var e;w("script",document.body,{attributes:{src:(e=I,g(e)?d().runtime.getURL(e):""),type:"text/javascript","data-type":"inline-listener"}})}static setListeners(){((e,t,...r)=>{E[e]?.(((...e)=>{t(...e)}),...r)})(A.OnMessage,(async e=>{M.processInlineListeners(e)})),$.debug().log("listeners were set")}connect(){D.setListeners(),D.connectInlineListener(),$.debug().log("connected")}getID(){return D.id}getName(){return b.if.Athena}getType(){return b.S9.Athena}}var k;$=n(2224).Et.addPrefix(D.id),function(e){e.AppShowExtension="AppShowExtension",e.AppTakeResourceData="AppTakeResourceData",e.AppTakeNewResourceData="AppTakeNewResourceData",e.AppSyncWatchers="AppSyncWatchers",e.AppQueryHasHash="AppQueryHasHash",e.AppQueryHasSpecifyFields="AppQueryHasSpecifyFields",e.AppSetLoadingState="AppSetLoadingState",e.AppToggleShowExtension="AppToggleShowExtension",e.AppSendToBackground="AppSendToBackground",e.AppSendMessageOutside="AppSendMessageOutside",e.AppTakeQuery="AppTakeQuery",e.AppSetDebugMode="AppSetDebugMode",e.AppTakeCallbackMessageResult="AppTakeCallbackMessageResult"}(k||(k={})),Object.values(k).forEach((e=>{if("app"!==(0,s.k$)(e))throw new Error(`Wrong app message type "${e}"`)}));const T=new D,R=n(2224).Et.addPrefix(T.getID()),O=()=>(e=>{try{return ace.edit(e)}catch(e){return null}})(document.querySelector(".ace_editor")),L=/((\s?)+,?to_hex(\s?)+\((\s?)+)?SHA256(\s?)+\((\s?)+CAST(\s?)+\((.*)AS\s+VARBINARY(\s?)+\)(\s?)+\)(\s?)+\)\s+(AS\s+(.*)\s+)?FROM/gi,P=/SELECT\s+(.)+FROM/gi;window.addEventListener("message",(e=>{const s=e.data;if(t((()=>r.ISModifyQuery===s.type),s,e)){const e=O();if(!e)return void R.error().log("editor not found",ace);const{resources:t,modifyType:r}=s.payload;let n=(e=>{const t=(e=>e.replace(/ +/g," "))((r=e,r.trim().replace(/(\r\n|\n|\r)/gm," "))).trim();var r;const{indexes:n,mappedIndexes:s}=["select","where","from","last","start","stop","limit","like","order by","group by","having","ilike"].reduce(((e,r)=>{const n=t.search(new RegExp(`${"select"===r?"^":"(\\s|\\t)"}${r}(\\s|\\t)`,"gi"));return n>-1&&(e.indexes.add(n),e.mappedIndexes.set(n,r)),e}),{indexes:new Set,mappedIndexes:new Map}),o=Array.from(n).sort(c);return o.reduce(((e,r,n)=>{const i=s.get(r),a=r,c=o[n+1]||t.length;return e[i]=t.substring(a,c).replace(new RegExp(i,"gi"),"").trim(),e}),{})})(e.getValue());"show all"===r&&(n={select:n.select,from:n.from}),n.where=(o=n.where||"",i=T.buildQueryParts(r,t),l="AND",o.length<1?i:`(${o}) ${l} ${i}`),e.setValue((e=>{let t=`SELECT ${e.select}`;return e.from&&(t+=` FROM ${e.from}`),e.where&&(t+=` WHERE ${e.where}`),e["group by"]&&(t+=` GROUP BY ${e["group by"]}`),e.having&&(t+=` HAVING ${e.having}`),e["order by"]&&(t+=` ORDER BY ${e["order by"]}`),e.like&&(t+=` LIKE ${e.like}`),e.ilike&&(t+=` ILIKE ${e.ilike}`),e.limit&&(t+=` LIMIT ${e.limit}`),e.last&&(t+=` LAST ${e.last}`),e.start&&(t+=` START ${e.start}`),e.stop&&(t+=` STOP ${e.stop}`),t})(n))}var o,i,l,d,u;if(t((()=>r.ISSetQuery===s.type),s,e)){const e=O();if(!e)return;const{value:t}=s.payload;e.setValue(t)}if(t((()=>r.ISGetQuery===s.type),s,e)){const e=O();if(!e)return;d=e.getValue(),window.postMessage({id:a(),type:p.CSDirectMessageToApp,payload:{type:k.AppTakeQuery,payload:{queryValue:d,queryMeta:u}}})}if(t((()=>r.ISSetDebugMode===s.type),s,e)){const{debugMode:e}=s.payload;n(2224).yD(e)}if(t((()=>r.ISRemoveHash===s.type),s,e)){const e=O();if(!e)return;const t=Array.from(e.getValue().matchAll(L)||[]);if(!t[0]||!t[0]?.[8])return;const r=t[0][8].trim(),n=t[0][0]||"",s=t[0][13]||"";let o=e.getValue();o=o.split(n).join(` ${r} FROM `),s.trim()&&(o=o.split(s.trim()).join(` ${r} `)),e.setValue(o)}if(t((()=>r.ISRemoveFieldSpecification===s.type),s,e)){const e=O();if(!e)return;const t=Array.from((e.getValue()||"").matchAll(P)||[])[0][0];let r=e.getValue();r=r.replace(t,"SELECT * FROM ").replace(/group\s+by.+/gi,""),e.setValue(r)}}));const C=new MutationObserver((()=>{(()=>{const e=O();if(!e)return;const t=Array.from(e.getValue().matchAll(P)||[]),r=(t?.[0]?.[0]||"").replace(/SELECT/i,"").replace(/FROM/i,"").replace(/ +/i,"").trim(),n=r.length>0&&"*"!==r;window.postMessage({id:a(),type:p.CSDirectMessageToApp,payload:{type:k.AppQueryHasSpecifyFields,payload:{show:n}}})})()})),Q=document.querySelector(".ace_content"),W=e=>{C.observe(e,{childList:!0,subtree:!0})};Q?W(Q):(async(e,t=document)=>new Promise((r=>{new MutationObserver(((n,s)=>{const o=t.querySelector(e);o&&(s.disconnect(),r(o))})).observe(t,{childList:!0,subtree:!0})})))(".ace_content",document.querySelector("body")).then((e=>W(e))),R.debug().log("mounted")})()})();